---
title: "Summary Commutes Procedure"
output: html_document
---

### import function and packages 
```{r message=FALSE, warning=FALSE}
library(here)
source(here("GMU_commute.R"))
library(tidyverse)
library(fs)
library(knitr)
```

## GMU_commute function 
To continue with the summary commutes procedure, run the GMU_commute.R file. The function will return the percentage of usable data for the inputted .csv file. "Usable data" is defined by: trips longer than 5 minutes and trips that properly record GPS data (i.e. trips that do not have "0" as input for the degrees variable).


## Loop through GPS data (.csv) 
Using the GPS data from the 32 participants, run their corresponding .csv files in the GMU_commute function. Some participants may have multiple .csv files with GPS data, refer to the [Summary files participants URA](https://gmuedu-my.sharepoint.com/:x:/r/personal/jkrall_gmu_edu/_layouts/15/Doc.aspx?sourcedoc=%7B499882A5-8F75-4AB5-9172-213A03D5E40D%7D&file=Summary%20files%20participants%20URA.xlsx&action=default&mobileredirect=true) to see how many files each participant has. 


### Initialize file path for GPS data 
The dir_ls function from the fs package locates the given folder, and extracts the file paths for each item in the folder. The GPS data folder contains the .csv GPS data files for all participants in green. 
```{r}
file_paths <- fs::dir_ls(here("GPS data"))
```

### Percentage of usable data (individual participants)
```{r}
file_contents <- matrix(nrow = length(file_paths), ncol = 4)
colnames(file_contents) <- c("participant","total_trips", "actual_trips", "percent_usable_trips")
```

```{r}
for (i in seq_along(file_paths)){
      file_contents[i, 1] <- substr(file_paths[i], start =51, stop = 56)
      file_contents[i, c(2, 3, 4)] <- GMU_commute(file = file_paths[[i]])
}
knitr::kable(file_contents, "simple")
```

### Percentage of usable data (all participants)
```{r}
mean(as.numeric(file_contents[,"percent_usable_trips"]))
```
The average percentage of usable trip data throughout all participants is approximately 47%. That is, within all of the GPS data collected in the Air Pollution study, 47% of the trips can actually be used in research.  


